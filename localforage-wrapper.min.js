"use strict";angular.module("capilleira.localforage-wrapper",[]).factory("LocalForageFactory",["$q","JSONArrayDriver",function(e,o){var r={DATE_FORMAT:"MM/DD/YYYY HH:mm:ss",LOCALFORAGE_EXPIRATION:{unit:"minutes",span:"15"}},n=function(e){return validator.stripLow(validator.escape(validator.trim(e))).replace(/[^\x00-\x7F]/gi,"").replace(/[^\x00-\x80]/gi,"").replace(/\\u/gi,"")},t=function(e){var o=_.clone(e,!0),r={};return _.isString(o)?r=n(o):_.isObject(o)&&_.forOwn(o,function(e,o){_.isString(e)&&(e=n(e)),r[o]=e}),r},a=function(){var e,o="capilleira__"+Math.round(1e7*Math.random()),r=window.sessionStorage;try{return e="localStorage"in window&&null!==window.localStorage,e&&(r.setItem(o,""),r.removeItem(o)),!0}catch(e){return!1}};return localforage.defineDriver(o.generateConfig()).then(function(){var e=[localforage.INDEXEDDB,localforage.WEBSQL,localforage.LOCALSTORAGE],o=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]);_.isNaN(o)&&(o=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1])),_.isNaN(o)||(console.log("IE detected, localforage using localstorage"),e=[localforage.LOCALSTORAGE]),a()||(e=["jsonArrayWrapper"]),localforage.config({name:"kZpVnlVcXkiOiI",version:1,storeName:"eaJcSmvKK496xmDaE7IFMgSXg",description:"4dWRZWkpEQXltL1dGMllRd0",driver:e})}),{retrieve:function(o){var n=e.defer();return localforage.getItem(o).then(function(e){if(_.isNull(e))n.resolve(null);else{var t,a=r.LOCALFORAGE_EXPIRATION.unit,l=r.LOCALFORAGE_EXPIRATION.span;e.expiration&&e.expiration.unit&&e.expiration.span&&(a=e.expiration.unit,l=e.expiration.span),t=moment().diff(moment(e.timeStamp,r.DATE_FORMAT),a),t>l?localforage.removeItem(o).then(function(){n.resolve(null)},function(e){console.error(e),n.resolve(null)}):n.resolve(e.value)}},function(e){console.error(e),n.reject(e)}),n.promise},set:function(o,n,a){console.log(o,n,a),a=a||r.LOCALFORAGE_EXPIRATION,console.log(a);var l=_.isArray(n),i=e.defer();return console.log(l),n=t(n),console.log(n),l&&(n=_.values(n)),console.log(n),console.log({value:n,timeStamp:moment().format(r.DATE_FORMAT),expiration:a}),localforage.setItem(o,{value:n,timeStamp:moment().format(r.DATE_FORMAT),expiration:a}).then(function(e){console.log(e),i.resolve(e)},function(e){console.log(e),console.error(e),i.reject(e)}),i.promise},remove:function(o){var r=e.defer();return localforage.removeItem(o).then(function(e){e?r.reject(e):r.resolve({status:"OK!"})}),r.promise}}}]);
"use strict";!function(){var e=[];angular.module("capilleira.localforage-wrapper").factory("JSONArrayDriver",["$q",function(r){return{generateConfig:function(){return{_driver:"jsonArrayWrapper",_support:!0,_initStorage:function(){e=[]},clear:function(){var n=r.defer();return e=[],n.resolve(e),n.promise},getItem:function(n){var o=r.defer(),t=_.find(e,{key:n})||{};return o.resolve(t.value||null),o.promise},iterate:function(){console.log("not implemented")},key:function(){console.log("not implemented")},keys:function(){console.log("not implemented")},length:function(){var n=r.defer();return n.resolve(e.length),n.promise},removeItem:function(n){var o=r.defer();return e=_.difference(e,[_.find(e,{key:n})]),o.resolve(e),o.promise},setItem:function(n,o){var t=r.defer();return e.push({key:n,value:o}),t.resolve(o),t.promise}}}}}])}();