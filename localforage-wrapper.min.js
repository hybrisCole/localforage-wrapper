"use strict";angular.module("capilleira.localforage-wrapper",[]).factory("LocalForageFactory",["$q",function(l){var s={DATE_FORMAT:"MM/DD/YYYY HH:mm:ss",LOCALFORAGE_EXPIRATION:{unit:"minutes",span:"45"}},u=function(e){return validator.stripLow(validator.escape(validator.trim(e))).replace(/[^\x00-\x7F]/gi,"").replace(/[^\x00-\x80]/gi,"").replace(/\\u/gi,"")};return localforage.config({name:"kZpVnlVcXkiOiI",version:1,storeName:"eaJcSmvKK496xmDaE7IFMgSXg",description:"4dWRZWkpEQXltL1dGMllRd0"}),{retrieve:function(o){var n=l.defer();return localforage.getItem(o).then(function(e){if(_.isNull(e))n.resolve(null);else{var r=s.LOCALFORAGE_EXPIRATION.unit,t=s.LOCALFORAGE_EXPIRATION.span;e.expiration&&e.expiration.unit&&e.expiration.span&&(r=e.expiration.unit,t=e.expiration.span),t<moment().diff(moment(e.timeStamp,s.DATE_FORMAT),r)?localforage.removeItem(o).then(function(){n.resolve(null)}).catch(function(e){console.error(e),n.resolve(null)}):n.resolve(e.value)}}).catch(function(e){console.error(e),n.reject(e)}),n.promise},remove:function(e){var r=l.defer();return localforage.removeItem(e).then(function(){r.resolve({status:"OK!"})}).catch(function(e){r.reject(e)}),r.promise},set:function(e,r,t){t=t||s.LOCALFORAGE_EXPIRATION;var o,n,i,a=_.isArray(r),c=l.defer();return o=r,n=_.clone(o,!0),i={},_.isString(n)?i=u(n):_.isObject(n)&&_.forOwn(n,function(e,r){_.isString(e)&&(e=u(e)),i[r]=e}),r=i,a&&(r=_.values(r)),localforage.setItem(e,{value:r,timeStamp:moment().format(s.DATE_FORMAT),expiration:t}).then(function(e){c.resolve(e)}).catch(function(e){console.error(e),c.reject(e)}),c.promise}}}]);