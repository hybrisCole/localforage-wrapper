"use strict";angular.module("capilleira.localforage-wrapper",[]).factory("LocalForageFactory",["$q","JSONArrayDriver",function(e,r){localforage.defineDriver(r.generateConfig());var o,t=["jsonArrayWrapper"],n={DATE_FORMAT:"MM/DD/YYYY HH:mm:ss",LOCALFORAGE_EXPIRATION:{unit:"minutes",span:"15"}},a=function(e){var r=_.clone(e,!0),o={};return _.isString(r)?o=i(r):_.isObject(r)&&_.forOwn(r,function(e,r){_.isString(e)&&(e=i(e)),o[r]=e}),o},i=function(e){return validator.stripLow(validator.escape(validator.trim(e))).replace(/[^\x00-\x7F]/gi,"").replace(/[^\x00-\x80]/gi,"").replace(/\\u/gi,"")};o=parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]),_.isNaN(o)&&(o=parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1])),_.isNaN(o)||(console.log("IE detected, localforage using localstorage"),t=[localforage.LOCALSTORAGE]);try{window.sessionStorage.setItem("test","1"),window.sessionStorage.removeItem("test")}catch(l){t=["jsonArrayWrapper"]}return localforage.config({name:"kZpVnlVcXkiOiI",version:1,storeName:"eaJcSmvKK496xmDaE7IFMgSXg",description:"4dWRZWkpEQXltL1dGMllRd0",driver:t}),{retrieve:function(r){var o=e.defer();return localforage.getItem(r).then(function(e){if(_.isNull(e))o.resolve(null);else{var t,a=n.LOCALFORAGE_EXPIRATION.unit,i=n.LOCALFORAGE_EXPIRATION.span;e.expiration&&e.expiration.unit&&e.expiration.span&&(a=e.expiration.unit,i=e.expiration.span),t=moment().diff(moment(e.timeStamp,n.DATE_FORMAT),a),t>i?localforage.removeItem(r).then(function(){o.resolve(null)},function(e){console.log(e),o.resolve(null)}):o.resolve(e.value)}},function(e){console.log(e),o.reject(e)}),o.promise},set:function(r,o,t){t=t||n.LOCALFORAGE_EXPIRATION;var i=_.isArray(o),l=e.defer();return o=a(o),i&&(o=_.values(o)),localforage.setItem(r,{value:o,timeStamp:moment().format(n.DATE_FORMAT),expiration:t}).then(function(e){l.resolve(e)},function(e){console.log(e),l.reject(e)}),l.promise},remove:function(r){var o=e.defer();return localforage.removeItem(r).then(function(e){e?o.reject(e):o.resolve({status:"OK!"})}),o.promise}}}]);
"use strict";angular.module("capilleira.localforage-wrapper").factory("JSONArrayDriver",["$q",function(e){var r=[];return{generateConfig:function(){return{_driver:"jsonArrayWrapper",_support:!0,_initStorage:function(){console.log(1),r=[]},clear:function(o){console.log(2);var n=e.defer();return r=[],n.resolve(r),o(null,r),n.promise},getItem:function(o,n){console.log(3);var l=e.defer(),t=_.find(r,{key:o});return l.resolve(t),n(null,t),l.promise},iterate:function(){console.log(4)},key:function(){console.log(5)},keys:function(){console.log(6)},length:function(o){console.log(7);var n=e.defer();return n.resolve(r.length),o(null,r),n.promise},removeItem:function(o,n){console.log(8);var l=e.defer();return r=_.difference(r,[_.find(r,{key:o})]),l.resolve(r),n(null,r),l.promise},setItem:function(o,n,l){console.log(9);var t=e.defer();return r.push({key:o,value:n}),t.resolve(r),l(null,r),t.promise}}}}}]);