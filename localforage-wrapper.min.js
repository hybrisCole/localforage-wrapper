"use strict";angular.module("capilleira.localforage-wrapper",[]).factory("LocalForageFactory",["$q",function(e){var r={DATE_FORMAT:"MM/DD/YYYY HH:mm:ss",LOCALFORAGE_EXPIRATION:{unit:"minutes",span:"15"}},t=function(e){return validator.stripLow(validator.escape(validator.trim(e))).replace(/[^\x00-\x7F]/gi,"").replace(/[^\x00-\x80]/gi,"").replace(/\\u/gi,"")},n=function(e){var r=_.clone(e,!0),n={};return _.isString(r)?n=t(r):_.isObject(r)&&_.forOwn(r,function(e,r){_.isString(e)&&(e=t(e)),n[r]=e}),n};return localforage.config({name:"kZpVnlVcXkiOiI",version:1,storeName:"eaJcSmvKK496xmDaE7IFMgSXg",description:"4dWRZWkpEQXltL1dGMllRd0"}),{retrieve:function(t){var n=e.defer();return localforage.getItem(t).then(function(e){if(_.isNull(e))n.resolve(null);else{var o,i=r.LOCALFORAGE_EXPIRATION.unit,a=r.LOCALFORAGE_EXPIRATION.span;e.expiration&&e.expiration.unit&&e.expiration.span&&(i=e.expiration.unit,a=e.expiration.span),o=moment().diff(moment(e.timeStamp,r.DATE_FORMAT),i),o>a?localforage.removeItem(t).then(function(){n.resolve(null)}).catch(function(e){console.error(e),n.resolve(null)}):n.resolve(e.value)}}).catch(function(e){console.error(e),n.reject(e)}),n.promise},set:function(t,o,i){i=i||r.LOCALFORAGE_EXPIRATION;var a=_.isArray(o),c=e.defer();return o=n(o),a&&(o=_.values(o)),localforage.setItem(t,{value:o,timeStamp:moment().format(r.DATE_FORMAT),expiration:i}).then(function(e){c.resolve(e)}).catch(function(e){console.error(e),c.reject(e)}),c.promise},remove:function(r){var t=e.defer();return localforage.removeItem(r).then(function(){t.resolve({status:"OK!"})}).catch(function(e){t.reject(e)}),t.promise}}}]);